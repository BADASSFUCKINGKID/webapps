<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Music Player</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jsmediatags@3.9.7/dist/jsmediatags.min.js"></script>

<style>
body {
  margin: 0;
  background: #0e0e0e;
  color: white;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.player {
  width: 100%;
  max-width: 360px;
  padding: 24px;
  text-align: center;
}

.cover {
  width: 280px;
  height: 280px;
  border-radius: 16px;
  object-fit: cover;
  margin-bottom: 20px;
  background: #222;
}

.title {
  font-size: 22px;
  font-weight: 600;
}

.artist {
  font-size: 16px;
  color: #aaa;
  margin-bottom: 30px;
}

.play-btn {
  width: 72px;
  height: 72px;
  border-radius: 50%;
  border: none;
  background: #1db954;
  font-size: 28px;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="player">
  <img id="cover" class="cover" src="" alt="cover">
  <div id="title" class="title">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
  <div id="artist" class="artist"></div>

  <button id="playBtn" class="play-btn">‚ñ∂</button>

  <audio id="audio" src="EsDeeKid - Rottweiler.mp3"></audio>
</div>

<script>
const tg = Telegram.WebApp;
tg.expand();

const audio = document.getElementById("audio");
const playBtn = document.getElementById("playBtn");
const titleEl = document.getElementById("title");
const artistEl = document.getElementById("artist");
const coverEl = document.getElementById("cover");

let playing = false;

// ‚ñ∂Ô∏è Play / Pause
playBtn.onclick = () => {
  if (!playing) {
    audio.play();
    playBtn.textContent = "‚è∏";
  } else {
    audio.pause();
    playBtn.textContent = "‚ñ∂";
  }
  playing = !playing;
};

// üéµ –ß–ò–¢–ê–ï–ú –ú–ï–¢–ê–î–ê–ù–ù–´–ï –ò–ó MP3
jsmediatags.read(audio.src, {
  onSuccess: function(tag) {
    const tags = tag.tags;

    titleEl.textContent = tags.title || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è";
    artistEl.textContent = tags.artist || "";

    // üñºÔ∏è –û–±–ª–æ–∂–∫–∞
    if (tags.picture) {
      const { data, format } = tags.picture;
      let base64String = "";
      for (let i = 0; i < data.length; i++) {
        base64String += String.fromCharCode(data[i]);
      }
      coverEl.src = `data:${format};base64,${btoa(base64String)}`;
    } else {
      coverEl.src = "https://via.placeholder.com/300x300?text=No+Cover";
    }
  },
  onError: function(error) {
    titleEl.textContent = "–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è MP3";
    console.log(error);
  }
});
</script>

</body>
</html>
